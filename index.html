<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot with Memory</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- –ë–ª–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã -->
<div id="dev-settings" style="display: none; padding: 10px; background: #ffe4e4; border: 1px solid red; margin-bottom: 10px;">
    <p style="margin: 0 0 5px 0;">üîß <b>–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</b></p>
    <input type="password" id="local-api-key" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á sk-or-..." style="width: 70%;">
    <button onclick="saveLocalKey()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <span id="key-status"></span>
</div>
    <!-- Language selector -->
    <div class="language-selector">
        <button class="language-btn" onclick="toggleLanguageDropdown()">
            <span class="flag" id="currentFlag">üá¨üáß</span>
            <span id="currentLangName">English</span>
            <span>‚ñº</span>
        </button>
        <div class="language-dropdown" id="languageDropdown"></div>
    </div>

<!-- Help Modal -->
<div class="help-modal-overlay" id="helpModal">
    <div class="help-modal">
        <button class="help-modal-close" onclick="closeHelpModal()">‚úï</button>
        
        <h1>üß† Memory Chatbot</h1>
        
        <section class="help-section">
            <h2>–ß—Ç–æ —ç—Ç–æ?</h2>
            <p>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π <strong>–∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç</strong> –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∞—Å. –ß–µ–º –±–æ–ª—å—à–µ –æ–±—â–∞–µ—Ç–µ—Å—å ‚Äî —Ç–µ–º –ª—É—á—à–µ –æ–Ω –≤–∞—Å –ø–æ–Ω–∏–º–∞–µ—Ç.</p>
        </section>
        
        <section class="help-section">
            <h2>–ß—Ç–æ –æ–Ω –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç?</h2>
            <ul>
                <li>üìã <strong>–§–∞–∫—Ç—ã</strong> ‚Äî –∏–º—è, —Ä–∞–±–æ—Ç–∞, –∏–Ω—Ç–µ—Ä–µ—Å—ã, –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</li>
                <li>üß† <strong>–ß–µ—Ä—Ç—ã –ª–∏—á–Ω–æ—Å—Ç–∏</strong> ‚Äî –∫–∞–∫ –≤—ã –¥—É–º–∞–µ—Ç–µ, —á—Ç–æ —Ü–µ–Ω–∏—Ç–µ</li>
                <li>üìÖ <strong>–•—Ä–æ–Ω–æ–ª–æ–≥–∏—è</strong> ‚Äî —Å–æ–±—ã—Ç–∏—è, –ø–ª–∞–Ω—ã, –≤–∞–∂–Ω—ã–µ –¥–∞—Ç—ã</li>
                <li>üë• <strong>–õ—é–¥–∏</strong> ‚Äî —Å–µ–º—å—è, –¥—Ä—É–∑—å—è, –∫–æ–ª–ª–µ–≥–∏ –∏–∑ –≤–∞—à–∏—Ö —Ä–∞—Å—Å–∫–∞–∑–æ–≤</li>
                <li>üí° <strong>–ò–Ω—Å–∞–π—Ç—ã</strong> ‚Äî –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –æ –≤–∞—Å</li>
            </ul>
        </section>
        
        <section class="help-section">
            <h2>üé§ –†–µ–∂–∏–º "Ask Me"</h2>
            <p>–í–∫–ª—é—á–∏—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å ‚Äî –±–æ—Ç –±—É–¥–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –≤–∞—Å –ª—É—á—à–µ. –í–æ–ø—Ä–æ—Å—ã –≤–ø–ª–µ—Ç–∞—é—Ç—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä.</p>
        </section>
        
        <section class="help-section">
            <h2>üîí –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å</h2>
            <p><strong>–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.</strong></p>
            <p>–ú—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –Ω–µ –º–æ–∂–µ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å –≤–∞—à—É –ø–µ—Ä–µ–ø–∏—Å–∫—É ‚Äî –æ–Ω–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –Ω–∞—à–∏ —Å–µ—Ä–≤–µ—Ä—ã.</p>
            <p>–°–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ <a href="https://openrouter.ai/privacy" target="_blank">OpenRouter</a> –¥–ª—è —Ä–∞–±–æ—Ç—ã –ò–ò.</p>
            <p>–ù–∞–∂–º–∏—Ç–µ "Clear Knowledge" —á—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å –≤—Å—ë –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.</p>
        </section>
        
        <section class="help-section">
            <h2>üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ?</h2>
            <ul>
                <li>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</li>
                <li>–≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π</li>
                <li>–ë–æ–ª—å—à–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏</li>
                <li>–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</li>
            </ul>
        </section>
        
        <section class="help-section">
            <h2>üë®‚Äçüíª –ê–≤—Ç–æ—Ä</h2>
            <p>–°–µ—Ä–≥–µ–π –ú–∞—Å–ª–∞–∫–æ–≤</p>
            <p>
               
                <a href="https://t.me/Nascor" target="_blank">Telegram</a>
            </p>
        </section>
        
        <div class="help-footer">
            <p>–í–µ—Ä—Å–∏—è 1.0 ¬∑ 2024</p>
        </div>
    </div>
</div>

    <!-- Translating overlay -->
    <div class="translating-overlay" id="translatingOverlay">
        <div class="spinner"></div>
        <div class="text" id="translatingText">Translating interface...</div>
    </div>

    <!-- API key section -->
<!-- Help button -->
<button class="help-btn" onclick="openHelpModal()" title="About">
    ?
</button>

    <!-- Main container -->
    <div class="main-container">
        <!-- Control panel -->
        <div class="controls">
            <button class="btn btn-primary" onclick="openKnowledgeModal()" data-i18n="btnKnowledge">
                üìö User Knowledge
            </button>
            <button class="btn btn-secondary" onclick="clearChat()" data-i18n="btnClearChat">
                üóëÔ∏è Clear Chat
            </button>
            <button class="btn btn-danger" onclick="clearKnowledge()" data-i18n="btnClearKnowledge">
                ‚ö†Ô∏è Clear Knowledge
            </button>
            <div class="counters-wrapper">
                <div class="counter-badge">
                    <span data-i18n="counterStyle">üé≠ Style:</span> <span class="style-count" id="styleCounter">10</span>
                </div>
                <div class="counter-badge">
                    <span data-i18n="counterHypotheses">üí° Hypotheses:</span> <span class="hypo-count" id="hypoCounter">16</span>
                </div>
                <div class="counter-badge">
                    <span data-i18n="counterGaps">üîç Gaps:</span> <span class="gaps-count" id="gapsCounter">6</span>
                </div>
            </div>
            <!-- –ü–æ—Å–ª–µ counters-wrapper, –≤–Ω—É—Ç—Ä–∏ .controls -->
<div class="ask-me-toggle-wrapper">
    <span class="ask-me-label" data-i18n="askMeMode">Ask Me Mode</span>
    <div class="ask-me-toggle disabled" id="askMeToggle" onclick="toggleAskMeMode()" title="">
        <div class="ask-me-slider" id="askMeSlider"></div>
    </div>
</div>
        </div>

        <!-- Chat area -->
        <div class="chat-area" id="chatArea">
            <div class="message system" data-i18n="welcomeMessage">
                Hello! I'm your personal assistant. Tell me about yourself, and I'll remember important information.
            </div>
        </div>

        <!-- Input form -->
        <div class="input-area">
            <form class="input-form" onsubmit="sendMessage(event)">
                <textarea 
                    class="message-input" 
                    id="messageInput" 
                    data-i18n-placeholder="inputPlaceholder"
                    placeholder="Enter message..."
                    rows="1"
                    onkeydown="handleKeyDown(event)"
                ></textarea>
                <button type="submit" class="send-btn" id="sendBtn" data-i18n="btnSend">
                    Send
                </button>
            </form>
        </div>
    </div>

    <!-- Fullscreen knowledge modal -->
    <div class="modal-overlay" id="knowledgeModal">
        <div class="modal-header">
            <h2 data-i18n="modalTitle">üìö Knowledge Base</h2>
            <button class="modal-close" onclick="closeKnowledgeModal()" data-i18n="btnClose">‚úï Close</button>
        </div>
        
        <div class="modal-tabs">
            <button class="modal-tab active" data-tab="facts" onclick="switchTab('facts')" data-i18n="tabFacts">
                üìã Facts
            </button>
            <button class="modal-tab" data-tab="traits" onclick="switchTab('traits')" data-i18n="tabTraits">
                üß† Personality Traits
            </button>
            <button class="modal-tab" data-tab="timeline" onclick="switchTab('timeline')" data-i18n="tabTimeline">
                üìÖ Timeline
            </button>
            <button class="modal-tab" data-tab="social" onclick="switchTab('social')" data-i18n="tabSocial">
                üë• Social
            </button>
            <button class="modal-tab" data-tab="style" onclick="switchTab('style')" data-i18n="tabStyle">
                üé≠ Communication Style
            </button>
            <button class="modal-tab" data-tab="hypotheses" onclick="switchTab('hypotheses')" data-i18n="tabHypotheses">
                üí° Hypotheses
            </button>
            <button class="modal-tab" data-tab="gaps" onclick="switchTab('gaps')" data-i18n="tabGaps">
                üîç White Spots
            </button>
        </div>
        
        <div class="modal-content">
            <!-- Info blocks -->
            <div id="styleInfo" class="tab-info" style="display: none;" data-i18n="styleInfo">
                <strong>‚ÑπÔ∏è Communication Style</strong> ‚Äî automatically generated every 10 messages based on personality trait analysis. You can edit settings manually.
            </div>
            <div id="hypothesesInfo" class="tab-info" style="display: none;" data-i18n="hypothesesInfo">
                <strong>üí° Hypotheses</strong> ‚Äî non-obvious insights about you, generated every 16 messages. Based on facts, traits, and timeline analysis. Read-only ‚Äî the AI refines these automatically.
            </div>
            <div id="socialInfo" class="tab-info" style="display: none;" data-i18n="socialInfo">
                <strong>üë• Social Connections</strong> ‚Äî people mentioned in your conversations. Click on a contact to see their profile. Facts are backed by quotes from your messages.
            </div>
            <div id="gapsInfo" class="tab-info" style="display: none;" data-i18n="gapsInfo">
                <strong>üîç White Spots</strong> ‚Äî important topics about you that remain unknown. The AI uses these to ask better questions. Updated every 6 messages. Read-only.
            </div>
            
            <!-- Readonly indicator -->
            <div id="readonlyIndicator" class="readonly-indicator" style="display: none;">
                <span data-i18n="readOnly">üîí Read-only</span>
            </div>
            
            <!-- Edit indicator -->
            <div id="editIndicator" class="edit-indicator">
                <span data-i18n="unsavedChanges">‚ö†Ô∏è Unsaved changes</span>
            </div>
            
            <!-- Social container (for accordion) -->
            <div id="socialContainer" class="social-container" style="display: none;">
            </div>
            
            <!-- Main textarea -->
            <textarea 
                id="knowledgeTextarea" 
                class="knowledge-textarea"
                oninput="onTextareaChange()"
            ></textarea>
            
            <!-- Edit buttons -->
            <div class="modal-buttons">
                <button id="cancelBtn" class="btn btn-secondary" onclick="cancelChanges()" style="display: none;" data-i18n="btnCancel">
                    Cancel
                </button>
                <button id="saveBtn" class="btn btn-primary" onclick="saveChanges()" style="display: none;" data-i18n="btnSave">
                    üíæ Save
                </button>
            </div>
        </div>
    </div>
    
    

    <script src="app.js"></script>
    <script src="ui.js"></script>
</body>
</html>