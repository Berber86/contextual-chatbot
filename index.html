<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Chatbot</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Ğ‘Ğ»Ğ¾Ğº Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ´Ğ»Ñ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ -->
    <div id="dev-settings" style="display: none; padding: 10px; background: #ffe4e4; border: 1px solid red; margin-bottom: 10px;">
        <p style="margin: 0 0 5px 0;">ğŸ”§ <b>Ğ ĞµĞ¶Ğ¸Ğ¼ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ°</b></p>
        <input type="password" id="local-api-key" placeholder="Ğ’ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ ĞºĞ»ÑÑ‡ sk-or-..." style="width: 70%;">
        <button onclick="saveLocalKey()">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
        <span id="key-status"></span>
    </div>

    <!-- Translating overlay -->
    <div class="translating-overlay" id="translatingOverlay">
        <div class="spinner"></div>
        <div class="text" id="translatingText">Translating interface...</div>
    </div>

    <!-- Header Bar -->
    <header class="header-bar">
        <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹ Ğ² Ğ»ĞµĞ²Ğ¾Ğ¼ Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ¼ ÑƒĞ³Ğ»Ñƒ -->
        <button class="header-btn knowledge-btn" onclick="openKnowledgeModal()" title="User Knowledge">
            ğŸ§ 
        </button>

        <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ¸ Ğ² Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğ¼ Ğ²ĞµÑ€Ñ…Ğ½ĞµĞ¼ ÑƒĞ³Ğ»Ñƒ -->
        <button class="header-btn help-btn" onclick="openHelpModal()" title="Help">
            ?
        </button>

        <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº (ÑˆĞµÑÑ‚ĞµÑ€Ñ‘Ğ½ĞºĞ°) -->
        <div class="settings-wrapper">
            <button class="header-btn settings-btn" onclick="toggleSettingsMenu()" title="Settings">
                âš™ï¸
            </button>
            <div class="settings-dropdown" id="settingsDropdown">
                <button class="settings-item" onclick="clearChat()">
                    <span class="settings-icon">ğŸ—‘ï¸</span>
                    <span data-i18n="btnClearChat">Clear Chat</span>
                </button>
                <button class="settings-item" onclick="clearKnowledge()">
                    <span class="settings-icon">âš ï¸</span>
                    <span data-i18n="btnClearKnowledge">Clear Knowledge</span>
                </button>
                <div class="settings-divider"></div>
                <!-- Ğ¯Ğ·Ñ‹ĞºĞ¾Ğ²Ğ¾Ğ¹ ÑĞµĞ»ĞµĞºÑ‚Ğ¾Ñ€ Ğ² Ğ¼ĞµĞ½Ñ -->
                <div class="language-menu-section">
                    <div class="language-selector-menu" id="languageSelectorMenu">
                        <!-- Ğ—Ğ´ĞµÑÑŒ Ğ±ÑƒĞ´ĞµÑ‚ Ğ²ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½ ÑĞ·Ñ‹Ğº Ñ‡ĞµÑ€ĞµĞ· JS -->
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Chat Container -->
    <main class="chat-container">
        <!-- Chat Area -->
        <div class="chat-area" id="chatArea">
            <div class="message system" data-i18n="welcomeMessage">
                Hello! I'm your personal assistant. Tell me about yourself, and I'll remember important information.
            </div>
        </div>

        <!-- Input Area (Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ğ½Ğ¾ Ğº Ğ½Ğ¸Ğ·Ñƒ) -->
        <div class="input-container">
            <!-- Ask Me Mode Toggle -->
            <div class="ask-me-container">
                <span class="ask-me-label" data-i18n="askMeMode">Ask Me Mode</span>
                <div class="ask-me-toggle disabled" id="askMeToggle" onclick="toggleAskMeMode()" title="">
                    <div class="ask-me-slider" id="askMeSlider"></div>
                </div>
            </div>

            <!-- Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ğ²Ğ²Ğ¾Ğ´Ğ° -->
            <form class="input-form" onsubmit="sendMessage(event)">
                <textarea 
                    class="message-input" 
                    id="messageInput" 
                    data-i18n-placeholder="inputPlaceholder"
                    placeholder="Enter message..."
                    rows="1"
                    onkeydown="handleKeyDown(event)"
                ></textarea>
                <button type="submit" class="send-btn" id="sendBtn" data-i18n="btnSend">
                    Send
                </button>
            </form>

            <!-- Counters (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸) -->
            <div class="counters-container" id="countersContainer">
                <div class="counter-badge">
                    <span data-i18n="counterStyle">ğŸ­ Style:</span> 
                    <span class="style-count" id="styleCounter">10</span>
                </div>
                <div class="counter-badge">
                    <span data-i18n="counterHypotheses">ğŸ’¡ Hypotheses:</span> 
                    <span class="hypo-count" id="hypoCounter">16</span>
                </div>
                <div class="counter-badge">
                    <span data-i18n="counterGaps">ğŸ” Gaps:</span> 
                    <span class="gaps-count" id="gapsCounter">6</span>
                </div>
            </div>
        </div>
    </main>

    <!-- Help Modal -->
    <div class="help-modal-overlay" id="helpModal">
        <div class="help-modal">
            <button class="help-modal-close" onclick="closeHelpModal()">âœ•</button>
            
            <h1>ğŸ§  Memory Chatbot</h1>
            
            <section class="help-section">
                <h2>What is this?</h2>
                <p>A personal AI assistant that <strong>remembers</strong> information about you. The more you chat â€” the better it understands you.</p>
            </section>
            
            <section class="help-section">
                <h2>What does it remember?</h2>
                <ul>
                    <li>ğŸ“‹ <strong>Facts</strong> â€” name, work, interests, preferences</li>
                    <li>ğŸ§  <strong>Personality</strong> â€” how you think, what you value</li>
                    <li>ğŸ“… <strong>Timeline</strong> â€” events, plans, important dates</li>
                    <li>ğŸ‘¥ <strong>People</strong> â€” family, friends, colleagues from your stories</li>
                    <li>ğŸ’¡ <strong>Insights</strong> â€” patterns and observations about you</li>
                </ul>
            </section>
            
            <section class="help-section">
                <h2>ğŸ¤ Ask Me Mode</h2>
                <p>Turn on the toggle â€” the bot will ask questions to learn more about you. Questions are woven naturally into conversation.</p>
            </section>
            
            <section class="help-section">
                <h2>ğŸ”’ Privacy</h2>
                <p><strong>All data is stored only on your device.</strong></p>
                <p>We technically cannot read your conversations â€” they are not sent to our servers.</p>
                <p>Messages are processed via <a href="https://openrouter.ai/privacy" target="_blank">OpenRouter</a> for AI to work.</p>
                <p>Click "Clear Knowledge" to delete everything instantly.</p>
            </section>
            
            <section class="help-section">
                <h2>ğŸš€ What's next?</h2>
                <ul>
                    <li>Cross-device sync (optional)</li>
                    <li>Export/import knowledge base</li>
                    <li>More personalization settings</li>
                    <li>Mobile app</li>
                </ul>
            </section>
            
            <section class="help-section">
                <h2>ğŸ‘¨â€ğŸ’» Author</h2>
                <p>Ğ¡ĞµÑ€Ğ³ĞµĞ¹ ĞœĞ°ÑĞ»Ğ°ĞºĞ¾Ğ²</p>
                <p>
                    <a href="https://t.me/Nascor" target="_blank">Telegram</a>
                </p>
            </section>
            
            <div class="help-footer">
                <p>Version 1.0 Â· 2024</p>
            </div>
        </div>
    </div>

    <!-- Fullscreen knowledge modal -->
    <div class="modal-overlay" id="knowledgeModal">
        <div class="modal-header">
            <h2 data-i18n="modalTitle">ğŸ“š Knowledge Base</h2>
            <button class="modal-close" onclick="closeKnowledgeModal()" data-i18n="btnClose">âœ• Close</button>
        </div>
        
        <div class="modal-tabs">
            <button class="modal-tab active" data-tab="facts" onclick="switchTab('facts')" data-i18n="tabFacts">
                ğŸ“‹ Facts
            </button>
            <button class="modal-tab" data-tab="traits" onclick="switchTab('traits')" data-i18n="tabTraits">
                ğŸ§  Personality Traits
            </button>
            <button class="modal-tab" data-tab="timeline" onclick="switchTab('timeline')" data-i18n="tabTimeline">
                ğŸ“… Timeline
            </button>
            <button class="modal-tab" data-tab="social" onclick="switchTab('social')" data-i18n="tabSocial">
                ğŸ‘¥ Social
            </button>
            <button class="modal-tab" data-tab="style" onclick="switchTab('style')" data-i18n="tabStyle">
                ğŸ­ Communication Style
            </button>
            <button class="modal-tab" data-tab="hypotheses" onclick="switchTab('hypotheses')" data-i18n="tabHypotheses">
                ğŸ’¡ Hypotheses
            </button>
            <button class="modal-tab" data-tab="gaps" onclick="switchTab('gaps')" data-i18n="tabGaps">
                ğŸ” White Spots
            </button>
        </div>
        
        <div class="modal-content">
            <!-- Info blocks -->
            <div id="styleInfo" class="tab-info" style="display: none;" data-i18n="styleInfo">
                <strong>â„¹ï¸ Communication Style</strong> â€” automatically generated every 10 messages based on personality trait analysis. You can edit settings manually.
            </div>
            <div id="hypothesesInfo" class="tab-info" style="display: none;" data-i18n="hypothesesInfo">
                <strong>ğŸ’¡ Hypotheses</strong> â€” non-obvious insights about you, generated every 16 messages. Based on facts, traits, and timeline analysis. Read-only â€” the AI refines these automatically.
            </div>
            <div id="socialInfo" class="tab-info" style="display: none;" data-i18n="socialInfo">
                <strong>ğŸ‘¥ Social Connections</strong> â€” people mentioned in your conversations. Click on a contact to see their profile. Facts are backed by quotes from your messages.
            </div>
            <div id="gapsInfo" class="tab-info" style="display: none;" data-i18n="gapsInfo">
                <strong>ğŸ” White Spots</strong> â€” important topics about you that remain unknown. The AI uses these to ask better questions. Updated every 6 messages. Read-only.
            </div>
            
            <!-- Readonly indicator -->
            <div id="readonlyIndicator" class="readonly-indicator" style="display: none;">
                <span data-i18n="readOnly">ğŸ”’ Read-only</span>
            </div>
            
            <!-- Edit indicator -->
            <div id="editIndicator" class="edit-indicator">
                <span data-i18n="unsavedChanges">âš ï¸ Unsaved changes</span>
            </div>
            
            <!-- Social container (for accordion) -->
            <div id="socialContainer" class="social-container" style="display: none;">
            </div>
            
            <!-- Main textarea -->
            <textarea 
                id="knowledgeTextarea" 
                class="knowledge-textarea"
                oninput="onTextareaChange()"
            ></textarea>
            
            <!-- Edit buttons -->
            <div class="modal-buttons">
                <button id="cancelBtn" class="btn btn-secondary" onclick="cancelChanges()" style="display: none;" data-i18n="btnCancel">
                    Cancel
                </button>
                <button id="saveBtn" class="btn btn-primary" onclick="saveChanges()" style="display: none;" data-i18n="btnSave">
                    ğŸ’¾ Save
                </button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script src="ui.js"></script>
</body>
</html>